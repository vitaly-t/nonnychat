
<style>
#chatlog {
    margin:auto;
    background-color:#ddd;
    padding:1em;
    margin:1em;
    position:absolute;
    left:1em; right:1em;
    top:30px;
    bottom:70px;
}
#chatinput {
    position:fixed;
    left:1em; right: 1em;
    bottom:1em;
}
#chatmsg {
    width:99%;
}
#btnSendMessage {
    width:99%;
}
.chatmsg {
    border:1px solid lightblue;
}
</style>

<div id="login">
Room: <input type='text' id='room' />
Username: <input type='text' id='username' />
<button id="joingame">Join Game</button>
</div>
<div id="welcome"></div>
<hr />
<div id="output" style="display:none;">
    <div id="chatlog"></div>
    <div id="chatinput">
        <input type="text" id="chatmsg" /> <br />
        <button id="btnSendMessage">Send</button>
    </div>
</div>


<script>


var HOST = location.origin.replace(/^http/, 'ws');

var username = false;
var room = false;
var chatlog;
var chatmsg;
var inputroom;
var inputusername;
var btnSendMsg;

function joingame(username,room) {

    if (username!="" && room !="") {

        document.querySelector("#login").style.display = "none";
        document.querySelector("#output").style.display = "block";

        chatlog = document.querySelector("#chatlog");
        chatmsg = document.querySelector("#chatmsg");
        inputroom = document.querySelector("#inputroom");
        inputusername = document.querySelector("#inputusername");
        btnSendMsg = document.querySelector("#btnSendMessage");

        chatmsg.focus();

        console.log(btnSendMsg);
        btnSendMsg.addEventListener("click", function() {
            console.log(room, username, chatmsg.value);
            chatmsg.value = chatmsg.value.trim();
            if (chatmsg.value!="") {
                msgdata = {
                    action:"chatmsg",
                    message: chatmsg.value,
                    room: room, 
                    username: username
                };
                chatmsg.value = "";
                chatmsg.focus();
        //            chatmsg.scrollIntoView();
                sock.send(JSON.stringify(msgdata));             
            }
        });



        let sock = new WebSocket(HOST);
        // When the socket is open and ready to receive/send events
        sock.onopen = (e) => {
        //	console.log(e);
            msgdata = {
                action:"init",
                username:username,
                room:room
            };
            // sent the JSON for the msgdata object to the target (above)
            e.target.send(JSON.stringify(msgdata));
        }

        // When a message is received (from the url above):
        sock.onmessage = function(m){
            var x = JSON.parse(m.data);
            if (x.action=="welcome") {
                document.querySelector("#welcome").innerHTML = x.content;
            }
            if (x.action=="log") {
                console.log(x.content);
            }
            if (x.action=="chatmsg") {
                console.log(x);
                var cm = document.createElement("div");            
                cm.className = "chatmsg";
                cm.innerHTML = "<em>" + x.content.timestamp + "</em><br /><strong>" + x.content.username + ":</strong> " + x.content.message;
                chatlog.appendChild(cm);
            }
        }

    }



}

var btnJoin = document.querySelector("#joingame");
btnJoin.addEventListener("click", () => {
    var un = document.querySelector("#username");
    username = un.value;
    var rm = document.querySelector("#room");
    room = rm.value;
    joingame(username, room);
});
//joingame();

</script>